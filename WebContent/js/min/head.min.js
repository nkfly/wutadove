function makeEntry(e){return"<entry><id>http://gdata.youtube.com/feeds/api/videos/"+e+"?v=2</id></entry>"}function youtubeBatchProcessing(e,t){for(var a='<feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:batch="http://schemas.google.com/gdata/batch" xmlns:yt="http://gdata.youtube.com/schemas/2007"><batch:operation type="query" />',o=0;o<e.length;o++)a+=makeEntry(e[o]);a+="</feed>",$.ajax({type:"POST",url:"http://gdata.youtube.com/feeds/api/videos/batch",data:a,dataType:"xml",contentType:"application/atom+xml",success:t})}function iso8601TimeToSeconds(e){return indexOfM=e.indexOf("M"),minute=parseInt(e.substring(2,indexOfM)),second=parseInt(e.substring(indexOfM+1)),60*minute+second}function sendUrlToServer(e,t){"null"!=e&&t.items&&(setupYoutubePlayer(e),$.post("/youtubeurl",{videoId:e,title:t.items[0].snippet.title,description:t.items[0].snippet.description,duration:toSimpleTime(iso8601TimeToSeconds(t.items[0].contentDetails.duration))},drawVisibleWaveform,"json"))}function drawVisibleWaveform(e){if("fail"==e.status)return $("#announcement-text").text("too long"==e.reason?"影片時間超過10分鐘！暫不支援。":decodeURIComponent(e.reason)),$("#screen").add("#announcement").fadeIn("fast"),void $("#loading").hide();waveform.data=e.data;var t={width:1e3,height:280};t.width=waveform.data.min.length||t.width;var a=t.height/65536,o="http://www.w3.org/2000/svg",n=document.getElementById("svg");n.setAttribute("width",t.width),n.setAttribute("height",t.height),waveform.timelineNode=$("<div id='timeline-offset'></div>").width(1).height($("#svg").height()).prependTo("#graph"),$("<div id='select-area-start' class='select-line'></div><div id='select-area'></div><div id='select-area-end' class='select-line'></div>").width(0).height($("#svg").height()).prependTo("#graph"),$("#select-area-start").mousedown(function(){waveform.isSelectAreaStartMouseDown=!0}),$("#select-area-end").mousedown(function(){waveform.isSelectAreaEndMouseDown=!0}),waveform.globalSvg=document.getElementById("svg"),waveform.globalGraph=$("#graph"),waveform.svgOriginalWidth=t.width,waveform.endNodeIndex=waveform.globalGraph.width();for(var i=0;i<waveform.globalGraph.width();i++)svgRect=document.createElementNS(o,"rect"),svgRect.setAttributeNS(null,"x",i),svgRect.setAttributeNS(null,"y",t.height/2-waveform.data.max[i]*a),svgRect.setAttributeNS(null,"width",1),svgRect.setAttributeNS(null,"height",(Math.abs(waveform.data.min[i])+waveform.data.max[i])*a),n.appendChild(svgRect);$("#edit").show(),$("#timestamp").show(),$("#control").show(),$("#svg").show(),placeTimeStamp(100,waveform.data.sample_rate,waveform.data.samples_per_pixel,waveform.data.duration,waveform.data.number_of_channel),verticalScaleHandler(41,$("#vertical-scale div.scale-bar")),restoreSubtitles(e.subtitles),e.isPublic&&($("#publish").tooltip("option","content","取消發佈"),$("#publish-mask").show()),$("#loading").hide(),edit.currentEditIndex>0&&changeRowFocus(getSubtitleRow(edit.currentEditIndex))}function toSimpleTime(e){time=parseInt(e);var t=Math.floor(time/60),a=time-60*t,o=Math.floor(time/3600),n=""+a,i=""+t;return 0!=o||0!=t?0==o?(1==n.length&&(n="0"+n),i+":"+n):(1==n.length&&(n="0"+n),1==i.length&&(i="0"+i),""+o+":"+i+":"+n):1==n.length?"0:0"+n:2==n.length?"0:"+n:void 0}function getEnvVar(){if(-1!=window.location.href.indexOf("localhost")){var e={urlPrefix:"http://localhost:8080/",clientId:"491270377673854",loginSuffix:"oauth/authorize/facebook/test"};return e}var e={urlPrefix:"http://www.wutadove.com/",clientId:"396120470510136",loginSuffix:"oauth/authorize/facebook"};return e}function redirectToSearchAdaptor(e,t){for(var a=getEnvVar(),o=a.urlPrefix+"search?",n=0;n<e.length;n++)o+="v="+e[n]+"&";o+="q="+encodeURIComponent(t),window.location.href=o}function getVideoInfoFromYoutube(e,t,a){$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/videos/"+e+"?v=2&alt=jsonc",dataType:"json",success:t,error:function(t){a(e,t)}})}function isYoutubeUrl(e){var t=e.split(/\s+/);return 1==t.length&&/(^https?:\/\/)?www\.youtube\.com\/watch\?/.test(t[0])?!0:!1}function searchInYoutube(e){var t=[];if(isYoutubeUrl(e)){for(var a=e.split("?")[1].split("&"),o=0;o<a.length;o++)if(/^v=/.test(a[o])){t.push(a[o].split("=")[1]);break}t.length>0&&redirectToSearchAdaptor(t,e)}else{var n=e,i=gapi.client.youtube.search.list({q:n,part:"snippet",type:"video",order:"relevance",maxResults:5,videoDuration:"medium"});i.execute(function(a){if(a.items){for(var o=0;o<a.items.length;o++)t.push(a.items[o].id.videoId);t.length>0&&redirectToSearchAdaptor(t,e)}})}}function close(){$(".box").fadeOut(function(){$("#screen").fadeOut()})}var youtube={videoId:null,player:null,startTime:0,endTime:0,isPlaying:!1,isSeeking:!1,currentTimeRecord:0},control={isLoop:!1,loopHandler:null,verticalIsMouseDown:!1,isChangeVerticalScaleFactor:!1,horizontalIsMouseDown:!1,isChangeHorizontalScaleFactor:!1},waveform={prevScrollLeft:0,timelineOffsetHandler:0,timelineOffset:0,timelineNode:null,globalSvg:null,svgOriginalWidth:null,globalGraph:null,timeElapsedPerPixel:null,endNodeIndex:0,data:null,horizontalScaleFactor:100,verticalScaleFactor:100,isClickNewTimelineOffset:!1,isSelectionMouseDown:!1,selectionStartOffset:0,selectionEndOffset:0,isAdjustStartSelectLine:!1,isAdjustEndSelectLine:!1,focusSelectAreaIndex:0,isSelectAreaStartMouseDown:!1,isSelectAreaEndMouseDown:!1,isFocusSelectedArea:!1,isSetAnchor:!1,pseudoNodeIndex:0,leftScrollHandler:null,rightScrollHandler:null},edit={numberOfRow:0,currentEditIndex:0,index:1,isShowVocab:!1,changed:{},lengthLimitOfSentence:20,isJapaneseSentenceChanged:!1},slide={index:1,numberOfItem:3,handler:0,isChanging:!1},loading={status:"more",index:0},tooltipInit={position:position={my:"left center",at:"right+10 center-20",collision:"fit"},offset:[-2,10],effect:"fade",opacity:.7,tooltipClass:"custom-tooltip"};$(document).ready(function(){$(document).keyup(function(e){var t=e.keyCode?e.keyCode:e.which;(27==t&&$("#origin-info").is(":visible")||$("#announcement").is(":visible"))&&close()}),$("#belief-tab").click(function(){$("#member-tab").removeClass("tab-focus"),$("#how-tab").removeClass("tab-focus"),$(this).addClass("tab-focus"),$("#origin-how").hide(),$("#origin-member").hide(),$("#origin-belief").show()}),$("#member-tab").click(function(){$("#belief-tab").removeClass("tab-focus"),$("#how-tab").removeClass("tab-focus"),$(this).addClass("tab-focus"),$("#origin-how").hide(),$("#origin-belief").hide(),$("#origin-member").show()}),$("#how-tab").click(function(){$("#belief-tab").removeClass("tab-focus"),$("#member-tab").removeClass("tab-focus"),$(this).addClass("tab-focus"),$("#origin-member").hide(),$("#origin-belief").hide(),$("#origin-how").show()}),$("#origin").click(function(){$("#screen").add("#origin-info").fadeIn("fast")}),$(".close").click(close),$("#keyin").keydown(function(e){13==e.keyCode&&""!=$(this).val()&&searchInYoutube($(this).val())}),$("#keyin-submit").click(function(){""!=$("#keyin").val()&&searchInYoutube($("#keyin").val())})}),$(document).ready(function(){$("#keyin").autocomplete({source:function(e,t){var a="AI39si4Uj3yNJpc9D-Wlmnk1qtvNP7abPCLjJ8uTIgWQ0My7KgjPNNB2TJndz3rX4CMnwBaXaRBSeInha75him5gDf6xRXCSUg",o=e.term;$.ajax({url:"http://suggestqueries.google.com/complete/search?hl=en&ds=yt&client=youtube&hjson=t&cp=1&q="+o+"&key="+a+"&format=5&alt=json&callback=?",dataType:"jsonp",success:function(e){t($.map(e[1],function(e){return{label:e[0],value:e[0]}}))}})},select:function(e,t){searchInYoutube(t.item.value)},focus:function(e,t){$("#keyin").val(t.item.value)}})});